# MTG Deck Schema

## Arguments & ideas / 争点・ラフアイディア

### 基本思想

- 最小限の記述でも許され、MTGAのデッキリストから直接変換可能な一方、やろうと思えば紙のカードの状態まで事細かに記述できるスキーマが理想
    - デッキの構成カードの状態や言語、フォイルかどうかなどが記述できると良い
        - その一方、オラクルはデッキにいちいち記述することではないので省くべきな気がする
- したがって、カードの種類を一意に識別さえできれば最低限許すべき
    - ID的な一意識別子は存在しない、強いて言うならエキスパンション略称＋コレクター番号の組み合わせだが、古いエキスパンションにそれは存在しないため不十分な説がある
    - 結局MTGのカード識別子として最も優秀なのは英語名なのかもしれない
    - 他言語だと、そもそも訳語が存在していないカードがある
- 英語名を識別子にするとして、それはそれで名前がないカード (http://mtgwiki.com/wiki/%EF%BC%BF%EF%BC%BF%EF%BC%BF%EF%BC%BF%EF%BC%BF) がUnhingedに収録されているのでそれが問題
    - 要素内を空白にすればそのカードとすればよいが、不具合との区別が難しい
    - アンダースコア5文字で登録されている場合が多いらしいが、それは便宜上であって公式じゃないんだよな...
    - とはいえ、英語名識別子に関するルールはXMLスキーマで定義できる部分ではないので、ここで考えなくても良いことではある

---

### ルート要素deck

- deck要素から始まる
    - env属性でプレイ環境(紙・MTGA・MO)を指定→なくても概念上デッキとして成立するのでオプショナル
    - format属性でフォーマットを指定→なくても概念上デッキとして成立する(カジュアルならどんな遊び方でも許容される)のでオプショナル
        - 一応format属性でcasual/none/freeあたりの名前で明示できるように選択肢は用意する
        - 公式認定フォーマットをとりあえず既定の選択肢とする。過去の物も含む。( http://mtgwiki.com/wiki/%E3%83%95%E3%82%A9%E3%83%BC%E3%83%9E%E3%83%83%E3%83%88)
            - standard, block, extended, pioneer, modern, legacy, vintage, pauper, commander, two-headed, brawl, sealed, booster-draft, rochester-draft
            - MOフォーマット
                - freeform, theme, prismatic, 100cards-singleton, tribal-wars, momir-basic, cube-draft, 1v1-commander, planeswalker
            - MTGAフォーマット
                - historic, historic-brawl, alchemy, explorer, artisan shakeup
            - カジュアル変種
                - planechase, vanguard, archenemy, conspiracy-draft, oath-breaker
            疲れたのでこの辺で列挙を止める
    - スタンダードやエクステンデッド・ブロック構築のようなローテーションフォーマットやリミテッドの場合、どの時点・どのエキスパンションで構築されたかの情報が必要
        - どうやって識別できるようにする？
            - 構築された日時を書いても、国ごとにエキスパンション発売日が違う場合があるだろうから一意に定まらない
                - だいたい、デッキは構築されてから何日かプレイされ続けるものである場合が多いので、あるタイムポイント一点を決めるというのがナンセンス
            - リミテッドの場合はエキスパンション略号、ローテーションフォーマットの場合は直近スタンダードリーガルセットのエキスパンション略号で識別すると誤解がなく一意 latestExpansionがよさげ、ただリミテの場合はlatestとかじゃないので名前に分岐が生じるか
    - それとは別に構築日時の属性constructedDateはオプショナルで存在してもいいと思う
    - 大会成績などは、デッキに紐づくというよりは大会成績記述用のスキーマでdeckを囲む形で記述する方が適切そう
    - 名前nameもオプショナルであっていい、白単アグロとか書くやつ
    - とりあえずこのぐらい、備考属性があってもいいかも

---

### deck要素の子要素

- deck内部はmain要素とside要素とcommander要素から構成される、side要素とcommander要素はオプショナル
    - sideやcommanderは存在しないフォーマットがある

- main要素
    - メインデッキを表現する
    - num属性：総枚数 必須
- side要素
    - サイドデッキを表現する
    - num属性：総枚数 必須
- commander要素
    - 統率領域に置かれるカードを表現する
    - num属性：総枚数 必須
        - 共闘や背景、アトラクションなど複数枚が置かれうる

---

### main, side, commander要素直下でカードタイプごとにグループ分けするべきか問題

- 複数のカードタイプを持つカードが存在し、分類が困難
    - カードタイプは排他的な属性ではないので、それをもってカード群の間に一意な境界は設けられない
- よって、creature要素を作ってその中にクリーチャーカードのcardItemを入れる、みたいなことはやらない
- クリーチャーカードの枚数を数えたりして統計を作りたいなら、cardItemを一つ一つ見てカウントしていけばいいし、その程度のパースにかかるコストはたかが知れている

---

### main, side, commander要素の子要素


- main, side, commander要素の内部は、基本的にはcardItem要素から構成される
    - ただし、sideとcommanderは微妙に要件が異なる
        - 統率者や相棒はサイドデッキ・統率領域でのみ有効になる性質
    - だから、相棒や統率者をcompanionCardItem, commanderCardItemといった形でcardItemから拡張し、
    - side内部ではcardItemとcompanionCardItemを両方許す
    - commander内部ではcardItemとcommanderCardItemを両方許す
    - 補助属性のためにそこまで大々的にやるのは大げさすぎると感じる、オプショナルな属性としてcommander="true"とかcompanion="true"をcardItemに許可するので十分かも？

- num属性で枚数を表現、必須
    - デジタルの均一なカードで構成されたケースで、冗長な記述を避けるために役立つ 紙で状態を事細かに記述する場合でも、num=1と書くことは要求したい
- 他に必要な性質をとりあえず列挙していこう。どれが必須なのか、どれを子要素にするか、どれを属性にするか、どの属性をグルーピングするかは後で考える
    - 英語名
    - 言語(英語でない場合)
    - 実カード名
    - カードタイプ(複数ありうる)
    - サブタイプ(複数ありうる)
    - マナ総量
    - 色
    - マナコスト
    - エキスパンション略号
    - コレクター番号
    - レアリティ
    - アーティスト
    - カード枠(旧枠、新枠、新新枠、拡張、フルアート、ショーケースなど)
    - フォイルかどうか
    - カード状態

#### このうちどれが必須なのか問題

基本思想として、MTGAのデッキリストから即座に変換できる程度に最小限の情報を許容する

だから、**英語名のみ必須で、それ以外はオプショナル**にする

英語名は一意識別子として機能する

- XMLを作る側は情報を取捨選択して柔軟に作成できるが、読み込む側のパースの単純さは犠牲になる。
    - たとえば、エキスパンション情報がないデッキリストを読み込んだとき、パーサはなんらかの解釈を加えて補完する必要がある(たとえば、デフォルトでそのカードが直近に収録されたエキスパンションを設定するとか)
    - 表現力を求めたからXMLを考えているわけで、表現力と単純さはトレードオフの関係にもあるので、単純さが犠牲になるのは仕方がないことだと思う

#### 何がcardItem要素の属性になるべきで、何が子要素になるべきなのか問題

まず列挙した性質をグループ分けする

- 一意識別子(英語名)
- ゲームに関与する情報
    - カードタイプ
    - サブタイプ
    - 色
    - マナコスト関連
        - マナコスト
        - マナ総量
- メタ情報
    - 言語
    - 実カード名
    - エキスパンション略号
    - コレクター番号
    - レアリティ
    - アーティスト
    - カード枠
    - 紙限定情報
        - フォイルかどうか
        - カード状態

ゲームに関与する情報はわざわざグループ内に入れる必要なく、個々の子要素として配置する

メタ情報は分かりやすいようにmeta要素でくくった方が良いかも

#### 子要素間の順序を強制するべきか？

- 順序を強制するとパーサが書きやすくなる
    - 順序は強制するべきだと思う、むしろ書き込む側にこの順番で書いてねという指示になる


---

### バージョンはどう管理するか？

XMLスキーマにおいてバージョン管理を行うための標準の方法が存在しないらしいので、アノテーションに記述する

deck要素に関しては、いったんここまでの考察を反映したものをバージョン0.1としてスキーマ作成したい

試しに自分でサンプルXMLファイルを作って検証してみて、だいたいOKだったら1.0とする感じで行くつもり



---

### デッキ内の役割としての情報をcardItemに載せるべきかどうか

cardItemそのものが持つ属性、マナコストなどのゲーム内情報や言語などのメタ情報と、それがデッキ内で持つ役割(統率者など)はまた階層の違う概念ではないだろうか

- 一つ目の案はcardItemに統率者かどうか、相棒かどうかなどの属性も持たせて必要なケースでだけ使う方法
    - シンプル
    - 本来使うべきでない部分でもcommander="true"の記述ができてしまい、不正な記法につながりやすい
- 二つ目の案はcardItemを拡張した別の型を作る方法 (commanderCardItem, companionCardItem)
    - 意味に忠実、構造を反映している
    - 別の要素を使う必要があるので汎用性が下がり、今後新たな役割が登場したとして新しく同様の要素を定義する必要がある

- 今回は表現力を求めているので、正しく構造を反映した二つ目の案を採用することとする。
- 要素名が変わるだけなので、XMLを作る側の負担はさして上がらない
